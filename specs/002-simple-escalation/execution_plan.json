{
  "execution_plan": {
    "phase_id": "Simple Mode with Auto-Escalation",
    "waves": [
      {
        "wave_id": 1,
        "strategy": "PARALLEL_SWARM",
        "rationale": "Wave 1: 16 independent task(s) with no file conflicts",
        "tasks": [
          {
            "task_id": "T001",
            "agent_role": "Developer",
            "instruction": "T001 Add `SimpleIterationRecord` and `FailureSummary` interfaces to `src/lifecycle/types.ts`",
            "file_locks": [
              "src/lifecycle/types.ts"
            ],
            "constitution_rules": [],
            "completion_handshake": "Upon success, update tasks.md line containing 'T001 Add `SimpleIterationRecord` and `FailureSummary` interfaces to `src/lifecycle/types.ts`' to [x]",
            "dependencies": []
          },
          {
            "task_id": "T003",
            "agent_role": "Developer",
            "instruction": "T003 Add `escalationContext?: string` field to `AgentContext` interface in `src/agents/base/agent-context.ts`",
            "file_locks": [
              "src/agents/base/agent-context.ts"
            ],
            "constitution_rules": [],
            "completion_handshake": "Upon success, update tasks.md line containing 'T003 Add `escalationContext?: string` field to `AgentContext` interface in `src/agents/base/agent-context.ts`' to [x]",
            "dependencies": []
          },
          {
            "task_id": "T005",
            "agent_role": "Developer",
            "instruction": "T005 Extract `runSimpleIteration()` function in `src/cli/commands/run.ts` \u2014 Artisan (phase 2) + Tests (phase 4) only, no Librarian or Critic",
            "file_locks": [
              "src/cli/commands/run.ts"
            ],
            "constitution_rules": [],
            "completion_handshake": "Upon success, update tasks.md line containing 'T005 Extract `runSimpleIteration()` function in `src/cli/commands/run.ts` \u2014 Artisan (phase 2) + Tests (phase 4) only, no Librarian or Critic' to [x]",
            "dependencies": []
          },
          {
            "task_id": "T008",
            "agent_role": "Developer",
            "instruction": "T008 [P] Register `--simple [N]`, `--no-escalate`, `--full` CLI flags with commander in `src/cli/ralph-loop.ts`",
            "file_locks": [
              "src/cli/ralph-loop.ts"
            ],
            "constitution_rules": [],
            "completion_handshake": "Upon success, update tasks.md line containing 'T008 [P] Register `--simple [N]`, `--no-escalate`, `--full` CLI flags with commander in `src/cli/ralph-loop.ts`' to [x]",
            "dependencies": []
          },
          {
            "task_id": "T010",
            "agent_role": "Developer",
            "instruction": "T010 [US1] Wire default behaviour in `runCommand()`: when neither `--simple` nor `--full` is passed, default to `--simple 5`",
            "file_locks": [],
            "constitution_rules": [],
            "completion_handshake": "Upon success, update tasks.md line containing 'T010 [US1] Wire default behaviour in `runCommand()`: when neither `--simple` nor `--full` is passed, default to `--simple 5`' to [x]",
            "dependencies": []
          },
          {
            "task_id": "T011",
            "agent_role": "Developer",
            "instruction": "T011 [US1] Wire budget check inside simple mode loop \u2014 call `isBudgetExceeded(context)` each iteration; if true, exit loop cleanly with budget-failure message",
            "file_locks": [],
            "constitution_rules": [],
            "completion_handshake": "Upon success, update tasks.md line containing 'T011 [US1] Wire budget check inside simple mode loop \u2014 call `isBudgetExceeded(context)` each iteration; if true, exit loop cleanly with budget-failure message' to [x]",
            "dependencies": []
          },
          {
            "task_id": "T012",
            "agent_role": "Developer",
            "instruction": "T012 [P] [US1] Update final report section in `runCommand()` for simple-only success output \u2014 show mode used, iterations, per-phase cost breakdown per `contracts/cli-interface.md`",
            "file_locks": [
              "contracts/cli-interface.md"
            ],
            "constitution_rules": [],
            "completion_handshake": "Upon success, update tasks.md line containing 'T012 [P] [US1] Update final report section in `runCommand()` for simple-only success output \u2014 show mode used, iterations, per-phase cost breakdown per `contracts/cli-interface.md`' to [x]",
            "dependencies": []
          },
          {
            "task_id": "T013",
            "agent_role": "Developer",
            "instruction": "T013 [P] [US1] Write unit tests for `buildFailureSummary()` in `tests/unit/lifecycle/simple-escalation.test.ts` \u2014 verify all error messages captured, summary capped at 500 tokens, deduplication works",
            "file_locks": [
              "tests/unit/lifecycle/simple-escalation.test.ts"
            ],
            "constitution_rules": [],
            "completion_handshake": "Upon success, update tasks.md line containing 'T013 [P] [US1] Write unit tests for `buildFailureSummary()` in `tests/unit/lifecycle/simple-escalation.test.ts` \u2014 verify all error messages captured, summary capped at 500 tokens, deduplication works' to [x]",
            "dependencies": []
          },
          {
            "task_id": "T015",
            "agent_role": "Developer",
            "instruction": "T015 [US1] Write integration test: simple mode success path in `tests/integration/escalation-flow.test.ts` \u2014 mock Artisan to succeed on iteration 2, confirm Librarian and Critic never called, confirm early exit",
            "file_locks": [
              "tests/integration/escalation-flow.test.ts"
            ],
            "constitution_rules": [],
            "completion_handshake": "Upon success, update tasks.md line containing 'T015 [US1] Write integration test: simple mode success path in `tests/integration/escalation-flow.test.ts` \u2014 mock Artisan to succeed on iteration 2, confirm Librarian and Critic never called, confirm early exit' to [x]",
            "dependencies": []
          },
          {
            "task_id": "T016",
            "agent_role": "Developer",
            "instruction": "T016 [US2] Add escalation trigger in `runCommand()` after simple mode loop \u2014 check `!noEscalate && !isBudgetExceeded(context) && !success`",
            "file_locks": [],
            "constitution_rules": [],
            "completion_handshake": "Upon success, update tasks.md line containing 'T016 [US2] Add escalation trigger in `runCommand()` after simple mode loop \u2014 check `!noEscalate && !isBudgetExceeded(context) && !success`' to [x]",
            "dependencies": []
          },
          {
            "task_id": "T018",
            "agent_role": "Developer",
            "instruction": "T018 [US2] Log escalation event \u2014 print summary preview (first 200 chars of `naturalLanguageSummary`) and remaining budget at handoff point",
            "file_locks": [],
            "constitution_rules": [],
            "completion_handshake": "Upon success, update tasks.md line containing 'T018 [US2] Log escalation event \u2014 print summary preview (first 200 chars of `naturalLanguageSummary`) and remaining budget at handoff point' to [x]",
            "dependencies": []
          },
          {
            "task_id": "T019",
            "agent_role": "Developer",
            "instruction": "T019 [US2] Update `LibrarianAgent.initialize()` in `src/agents/librarian/librarian.agent.ts` \u2014 if `context.escalationContext` is present, prepend it to the analysis prompt with a clear header (\"PRIOR ATTEMPTS:\")",
            "file_locks": [
              "context.escalationContext",
              "src/agents/librarian/librarian.agent.ts"
            ],
            "constitution_rules": [],
            "completion_handshake": "Upon success, update tasks.md line containing 'T019 [US2] Update `LibrarianAgent.initialize()` in `src/agents/librarian/librarian.agent.ts` \u2014 if `context.escalationContext` is present, prepend it to the analysis prompt with a clear header (\"PRIOR ATTEMPTS:\")' to [x]",
            "dependencies": []
          },
          {
            "task_id": "T020",
            "agent_role": "Developer",
            "instruction": "T020 [US2] Wire full mode loop after escalation \u2014 continue into existing `runSingleIteration()` loop using escalation-enriched context",
            "file_locks": [],
            "constitution_rules": [],
            "completion_handshake": "Upon success, update tasks.md line containing 'T020 [US2] Wire full mode loop after escalation \u2014 continue into existing `runSingleIteration()` loop using escalation-enriched context' to [x]",
            "dependencies": []
          },
          {
            "task_id": "T024",
            "agent_role": "Developer",
            "instruction": "T024 [US3] Implement `--no-escalate` guard in `runCommand()` \u2014 after simple loop, if `noEscalate=true` and `!success`, skip escalation trigger and exit with failure report",
            "file_locks": [],
            "constitution_rules": [],
            "completion_handshake": "Upon success, update tasks.md line containing 'T024 [US3] Implement `--no-escalate` guard in `runCommand()` \u2014 after simple loop, if `noEscalate=true` and `!success`, skip escalation trigger and exit with failure report' to [x]",
            "dependencies": []
          },
          {
            "task_id": "T025",
            "agent_role": "Developer",
            "instruction": "T025 [US3] Implement `--full` bypass in `runCommand()` \u2014 if `fullMode=true`, skip simple mode loop entirely and jump directly to full mode loop",
            "file_locks": [],
            "constitution_rules": [],
            "completion_handshake": "Upon success, update tasks.md line containing 'T025 [US3] Implement `--full` bypass in `runCommand()` \u2014 if `fullMode=true`, skip simple mode loop entirely and jump directly to full mode loop' to [x]",
            "dependencies": []
          },
          {
            "task_id": "T028",
            "agent_role": "Developer",
            "instruction": "T028 Validate all 216 existing tests still pass with `npm test` \u2014 confirm no regressions from context type changes or run.ts modifications; total test count should be \u2265 230",
            "file_locks": [
              "run.ts"
            ],
            "constitution_rules": [],
            "completion_handshake": "Upon success, update tasks.md line containing 'T028 Validate all 216 existing tests still pass with `npm test` \u2014 confirm no regressions from context type changes or run.ts modifications; total test count should be \u2265 230' to [x]",
            "dependencies": []
          }
        ],
        "checkpoint_after": {
          "enabled": true,
          "verification_criteria": "Verify all Wave 1 tasks are marked [x] in tasks.md",
          "git_agent": "git-version-manager",
          "memory_bank_agent": "memory-bank-keeper"
        }
      },
      {
        "wave_id": 2,
        "strategy": "PARALLEL_SWARM",
        "rationale": "Wave 2: 6 independent task(s) with no file conflicts",
        "tasks": [
          {
            "task_id": "T002",
            "agent_role": "Developer",
            "instruction": "T002 Add `EscalationEvent` interface to `src/lifecycle/types.ts`",
            "file_locks": [
              "src/lifecycle/types.ts"
            ],
            "constitution_rules": [],
            "completion_handshake": "Upon success, update tasks.md line containing 'T002 Add `EscalationEvent` interface to `src/lifecycle/types.ts`' to [x]",
            "dependencies": [
              "T001"
            ]
          },
          {
            "task_id": "T004",
            "agent_role": "Developer",
            "instruction": "T004 Add `withEscalationContext(context, summary)` immutable update function to `src/agents/base/agent-context.ts`",
            "file_locks": [
              "src/agents/base/agent-context.ts"
            ],
            "constitution_rules": [],
            "completion_handshake": "Upon success, update tasks.md line containing 'T004 Add `withEscalationContext(context, summary)` immutable update function to `src/agents/base/agent-context.ts`' to [x]",
            "dependencies": [
              "T003"
            ]
          },
          {
            "task_id": "T006",
            "agent_role": "Developer",
            "instruction": "T006 Implement `buildFailureSummary(records: SimpleIterationRecord[]): FailureSummary` in `src/cli/commands/run.ts` \u2014 generates `naturalLanguageSummary` text block from accumulated records, deduplicated error signatures, capped at 500 tokens",
            "file_locks": [
              "src/cli/commands/run.ts"
            ],
            "constitution_rules": [],
            "completion_handshake": "Upon success, update tasks.md line containing 'T006 Implement `buildFailureSummary(records: SimpleIterationRecord[]): FailureSummary` in `src/cli/commands/run.ts` \u2014 generates `naturalLanguageSummary` text block from accumulated records, deduplicated error signatures, capped at 500 tokens' to [x]",
            "dependencies": [
              "T005"
            ]
          },
          {
            "task_id": "T014",
            "agent_role": "Developer",
            "instruction": "T014 [P] [US1] Write unit tests for `withEscalationContext()` in `tests/unit/lifecycle/simple-escalation.test.ts` \u2014 verify immutability (original context unchanged), field set correctly",
            "file_locks": [
              "tests/unit/lifecycle/simple-escalation.test.ts"
            ],
            "constitution_rules": [],
            "completion_handshake": "Upon success, update tasks.md line containing 'T014 [P] [US1] Write unit tests for `withEscalationContext()` in `tests/unit/lifecycle/simple-escalation.test.ts` \u2014 verify immutability (original context unchanged), field set correctly' to [x]",
            "dependencies": [
              "T013"
            ]
          },
          {
            "task_id": "T021",
            "agent_role": "Developer",
            "instruction": "T021 [US2] Update final report for escalation + full mode success output \u2014 show `Simple \u2192 Full (escalated)`, iterations per phase, cost per phase per `contracts/cli-interface.md`",
            "file_locks": [
              "contracts/cli-interface.md"
            ],
            "constitution_rules": [],
            "completion_handshake": "Upon success, update tasks.md line containing 'T021 [US2] Update final report for escalation + full mode success output \u2014 show `Simple \u2192 Full (escalated)`, iterations per phase, cost per phase per `contracts/cli-interface.md`' to [x]",
            "dependencies": [
              "T012"
            ]
          },
          {
            "task_id": "T023",
            "agent_role": "Developer",
            "instruction": "T023 [US2] Write integration test: escalation path in `tests/integration/escalation-flow.test.ts` \u2014 mock Artisan to fail N times in simple mode, confirm escalation fires, confirm Librarian prompt contains failure summary, confirm full mode succeeds",
            "file_locks": [
              "tests/integration/escalation-flow.test.ts"
            ],
            "constitution_rules": [],
            "completion_handshake": "Upon success, update tasks.md line containing 'T023 [US2] Write integration test: escalation path in `tests/integration/escalation-flow.test.ts` \u2014 mock Artisan to fail N times in simple mode, confirm escalation fires, confirm Librarian prompt contains failure summary, confirm full mode succeeds' to [x]",
            "dependencies": [
              "T015"
            ]
          }
        ],
        "checkpoint_after": {
          "enabled": true,
          "verification_criteria": "Verify all Wave 2 tasks are marked [x] in tasks.md",
          "git_agent": "git-version-manager",
          "memory_bank_agent": "memory-bank-keeper"
        }
      },
      {
        "wave_id": 3,
        "strategy": "PARALLEL_SWARM",
        "rationale": "Wave 3: 4 independent task(s) with no file conflicts",
        "tasks": [
          {
            "task_id": "T007",
            "agent_role": "Developer",
            "instruction": "T007 [P] Add `simpleIterations`, `noEscalate`, `fullMode` fields to `RunOptions` interface in `src/cli/commands/run.ts`",
            "file_locks": [
              "src/cli/commands/run.ts"
            ],
            "constitution_rules": [],
            "completion_handshake": "Upon success, update tasks.md line containing 'T007 [P] Add `simpleIterations`, `noEscalate`, `fullMode` fields to `RunOptions` interface in `src/cli/commands/run.ts`' to [x]",
            "dependencies": [
              "T005",
              "T006"
            ]
          },
          {
            "task_id": "T022",
            "agent_role": "Developer",
            "instruction": "T022 [P] [US2] Write unit tests for escalation trigger logic in `tests/unit/lifecycle/simple-escalation.test.ts` \u2014 verify triggers at correct iteration count, blocked when budget exhausted, blocked by `--no-escalate`",
            "file_locks": [
              "tests/unit/lifecycle/simple-escalation.test.ts"
            ],
            "constitution_rules": [],
            "completion_handshake": "Upon success, update tasks.md line containing 'T022 [P] [US2] Write unit tests for escalation trigger logic in `tests/unit/lifecycle/simple-escalation.test.ts` \u2014 verify triggers at correct iteration count, blocked when budget exhausted, blocked by `--no-escalate`' to [x]",
            "dependencies": [
              "T013",
              "T014"
            ]
          },
          {
            "task_id": "T026",
            "agent_role": "Developer",
            "instruction": "T026 [US3] Update final report for full-failure (both modes failed) output \u2014 show error summary for each phase per `contracts/cli-interface.md`",
            "file_locks": [
              "contracts/cli-interface.md"
            ],
            "constitution_rules": [],
            "completion_handshake": "Upon success, update tasks.md line containing 'T026 [US3] Update final report for full-failure (both modes failed) output \u2014 show error summary for each phase per `contracts/cli-interface.md`' to [x]",
            "dependencies": [
              "T012",
              "T021"
            ]
          },
          {
            "task_id": "T027",
            "agent_role": "Developer",
            "instruction": "T027 [P] [US3] Write integration tests for flag behaviour in `tests/integration/escalation-flow.test.ts` \u2014 `--no-escalate` blocks full mode, `--full` skips simple mode, `--simple 3` escalates at exactly iteration 3",
            "file_locks": [
              "tests/integration/escalation-flow.test.ts"
            ],
            "constitution_rules": [],
            "completion_handshake": "Upon success, update tasks.md line containing 'T027 [P] [US3] Write integration tests for flag behaviour in `tests/integration/escalation-flow.test.ts` \u2014 `--no-escalate` blocks full mode, `--full` skips simple mode, `--simple 3` escalates at exactly iteration 3' to [x]",
            "dependencies": [
              "T015",
              "T023"
            ]
          }
        ],
        "checkpoint_after": {
          "enabled": true,
          "verification_criteria": "Verify all Wave 3 tasks are marked [x] in tasks.md",
          "git_agent": "git-version-manager",
          "memory_bank_agent": "memory-bank-keeper"
        }
      },
      {
        "wave_id": 4,
        "strategy": "SEQUENTIAL_MERGE",
        "rationale": "Wave 4: 1 independent task(s) with no file conflicts",
        "tasks": [
          {
            "task_id": "T009",
            "agent_role": "Developer",
            "instruction": "T009 [US1] Add simple mode sub-loop in `runCommand()` in `src/cli/commands/run.ts` \u2014 runs `runSimpleIteration()` for up to N iterations, accumulates `SimpleIterationRecord[]`, exits on success",
            "file_locks": [
              "src/cli/commands/run.ts"
            ],
            "constitution_rules": [],
            "completion_handshake": "Upon success, update tasks.md line containing 'T009 [US1] Add simple mode sub-loop in `runCommand()` in `src/cli/commands/run.ts` \u2014 runs `runSimpleIteration()` for up to N iterations, accumulates `SimpleIterationRecord[]`, exits on success' to [x]",
            "dependencies": [
              "T005",
              "T006",
              "T007"
            ]
          }
        ],
        "checkpoint_after": {
          "enabled": true,
          "verification_criteria": "Verify all Wave 4 tasks are marked [x] in tasks.md",
          "git_agent": "git-version-manager",
          "memory_bank_agent": "memory-bank-keeper"
        }
      },
      {
        "wave_id": 5,
        "strategy": "SEQUENTIAL_MERGE",
        "rationale": "Wave 5: 1 independent task(s) with no file conflicts",
        "tasks": [
          {
            "task_id": "T017",
            "agent_role": "Developer",
            "instruction": "T017 [US2] Call `buildFailureSummary(records)` and `withEscalationContext(context, summary)` at escalation point in `src/cli/commands/run.ts`",
            "file_locks": [
              "src/cli/commands/run.ts"
            ],
            "constitution_rules": [],
            "completion_handshake": "Upon success, update tasks.md line containing 'T017 [US2] Call `buildFailureSummary(records)` and `withEscalationContext(context, summary)` at escalation point in `src/cli/commands/run.ts`' to [x]",
            "dependencies": [
              "T009",
              "T005",
              "T006",
              "T007"
            ]
          }
        ],
        "checkpoint_after": {
          "enabled": true,
          "verification_criteria": "Verify all Wave 5 tasks are marked [x] in tasks.md",
          "git_agent": "git-version-manager",
          "memory_bank_agent": "memory-bank-keeper"
        }
      }
    ]
  }
}