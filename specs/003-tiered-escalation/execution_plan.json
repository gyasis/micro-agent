{
  "execution_plan": {
    "phase_id": "Multi-Tier Model Escalation",
    "waves": [
      {
        "wave_id": 1,
        "strategy": "PARALLEL_SWARM",
        "rationale": "Wave 1: 13 independent task(s) with no file conflicts",
        "tasks": [
          {
            "task_id": "T001",
            "agent_role": "Developer",
            "instruction": "T001 Install `better-sqlite3` and `@types/better-sqlite3` \u2014 add to `package.json` dependencies and devDependencies via `npm install better-sqlite3 && npm install -D @types/better-sqlite3`",
            "file_locks": [
              "package.json"
            ],
            "constitution_rules": [],
            "completion_handshake": "Upon success, update tasks.md line containing 'T001 Install `better-sqlite3` and `@types/better-sqlite3` \u2014 add to `package.json` dependencies and devDependencies via `npm install better-sqlite3 && npm install -D @types/better-sqlite3`' to [x]",
            "dependencies": []
          },
          {
            "task_id": "T002",
            "agent_role": "Developer",
            "instruction": "T002 Create `src/lifecycle/types.ts` with shared interfaces: `TierAttemptRecord`, `TierRunResult`, `RunMetadataRow`, `AccumulatedFailureSummary` \u2014 field definitions from `specs/003-tiered-escalation/data-model.md`",
            "file_locks": [
              "specs/003-tiered-escalation/data-model.md",
              "src/lifecycle/types.ts"
            ],
            "constitution_rules": [],
            "completion_handshake": "Upon success, update tasks.md line containing 'T002 Create `src/lifecycle/types.ts` with shared interfaces: `TierAttemptRecord`, `TierRunResult`, `RunMetadataRow`, `AccumulatedFailureSummary` \u2014 field definitions from `specs/003-tiered-escalation/data-model.md`' to [x]",
            "dependencies": []
          },
          {
            "task_id": "T003",
            "agent_role": "Developer",
            "instruction": "T003 Create Zod schemas `TierModelsSchema`, `TierConfigSchema`, `TierEscalationConfigSchema` in `src/lifecycle/tier-config.ts` \u2014 schema exactly as specified in `specs/003-tiered-escalation/contracts/tier-config-schema.md` and `specs/003-tiered-escalation/research.md` Decision 2",
            "file_locks": [
              "src/lifecycle/tier-config.ts",
              "specs/003-tiered-escalation/research.md",
              "specs/003-tiered-escalation/contracts/tier-config-schema.md"
            ],
            "constitution_rules": [],
            "completion_handshake": "Upon success, update tasks.md line containing 'T003 Create Zod schemas `TierModelsSchema`, `TierConfigSchema`, `TierEscalationConfigSchema` in `src/lifecycle/tier-config.ts` \u2014 schema exactly as specified in `specs/003-tiered-escalation/contracts/tier-config-schema.md` and `specs/003-tiered-escalation/research.md` Decision 2' to [x]",
            "dependencies": []
          },
          {
            "task_id": "T005",
            "agent_role": "Developer",
            "instruction": "T005 [P] Add `tierConfig?: string` field to `RunOptions` interface and register `--tier-config <path>` CLI flag in `src/ralph-loop.ts` \u2014 follows existing commander option registration pattern",
            "file_locks": [
              "src/ralph-loop.ts"
            ],
            "constitution_rules": [],
            "completion_handshake": "Upon success, update tasks.md line containing 'T005 [P] Add `tierConfig?: string` field to `RunOptions` interface and register `--tier-config <path>` CLI flag in `src/ralph-loop.ts` \u2014 follows existing commander option registration pattern' to [x]",
            "dependencies": []
          },
          {
            "task_id": "T006",
            "agent_role": "Developer",
            "instruction": "T006 [P] Add `tierConfigFile?: string` to YAML config schema in `src/config/` (whichever file defines the config type) so that `micro-agent.yml` entries are respected as a fallback when `--tier-config` flag is absent",
            "file_locks": [
              "micro-agent.yml"
            ],
            "constitution_rules": [],
            "completion_handshake": "Upon success, update tasks.md line containing 'T006 [P] Add `tierConfigFile?: string` to YAML config schema in `src/config/` (whichever file defines the config type) so that `micro-agent.yml` entries are respected as a fallback when `--tier-config` flag is absent' to [x]",
            "dependencies": []
          },
          {
            "task_id": "T007",
            "agent_role": "Developer",
            "instruction": "T007 [US1] Create `runTier(tier, tierIndex, context, agents, testRunner, db, runId)` in `src/lifecycle/tier-engine.ts` \u2014 implements the simple-mode iteration loop: calls `runSimpleIteration()` (from `src/cli/commands/run.ts`) up to `tier.maxIterations` times, records each iteration into `TierAttemptRecord[]`, checks `isBudgetExceeded()` after each iteration, exits loop on success or budget exhaustion, returns `TierRunResult` with `exitReason: 'success' | 'iterations_exhausted' | 'budget_exhausted' | 'provider_error'`",
            "file_locks": [
              "src/cli/commands/run.ts",
              "tier.maxIterations",
              "src/lifecycle/tier-engine.ts"
            ],
            "constitution_rules": [],
            "completion_handshake": "Upon success, update tasks.md line containing 'T007 [US1] Create `runTier(tier, tierIndex, context, agents, testRunner, db, runId)` in `src/lifecycle/tier-engine.ts` \u2014 implements the simple-mode iteration loop: calls `runSimpleIteration()` (from `src/cli/commands/run.ts`) up to `tier.maxIterations` times, records each iteration into `TierAttemptRecord[]`, checks `isBudgetExceeded()` after each iteration, exits loop on success or budget exhaustion, returns `TierRunResult` with `exitReason: 'success' | 'iterations_exhausted' | 'budget_exhausted' | 'provider_error'`' to [x]",
            "dependencies": []
          },
          {
            "task_id": "T012",
            "agent_role": "Developer",
            "instruction": "T012 [P] [US1] Write unit tests for `loadTierConfig()` and `validateTierConfig()` in `tests/unit/lifecycle/tier-config.test.ts`:",
            "file_locks": [
              "tests/unit/lifecycle/tier-config.test.ts"
            ],
            "constitution_rules": [],
            "completion_handshake": "Upon success, update tasks.md line containing 'T012 [P] [US1] Write unit tests for `loadTierConfig()` and `validateTierConfig()` in `tests/unit/lifecycle/tier-config.test.ts`:' to [x]",
            "dependencies": []
          },
          {
            "task_id": "T013",
            "agent_role": "Developer",
            "instruction": "T013 [US2] Create `buildAccumulatedSummary(priorResults: TierRunResult[]): AccumulatedFailureSummary` in `src/lifecycle/tier-accumulator.ts` \u2014 concatenates each prior tier's records into natural-language blocks with `=== TIER N FAILURES: <name> (K iterations) ===` headers; deduplicates error signatures across all tiers; caps total at 4000 characters by truncating oldest tier history first with `[truncated]` marker; includes total-across-tiers footer line",
            "file_locks": [
              "src/lifecycle/tier-accumulator.ts"
            ],
            "constitution_rules": [],
            "completion_handshake": "Upon success, update tasks.md line containing 'T013 [US2] Create `buildAccumulatedSummary(priorResults: TierRunResult[]): AccumulatedFailureSummary` in `src/lifecycle/tier-accumulator.ts` \u2014 concatenates each prior tier's records into natural-language blocks with `=== TIER N FAILURES: <name> (K iterations) ===` headers; deduplicates error signatures across all tiers; caps total at 4000 characters by truncating oldest tier history first with `[truncated]` marker; includes total-across-tiers footer line' to [x]",
            "dependencies": []
          },
          {
            "task_id": "T019",
            "agent_role": "Developer",
            "instruction": "T019 [P] [US2] Write unit tests for `buildAccumulatedSummary()` in `tests/unit/lifecycle/tier-accumulator.test.ts`:",
            "file_locks": [
              "tests/unit/lifecycle/tier-accumulator.test.ts"
            ],
            "constitution_rules": [],
            "completion_handshake": "Upon success, update tasks.md line containing 'T019 [P] [US2] Write unit tests for `buildAccumulatedSummary()` in `tests/unit/lifecycle/tier-accumulator.test.ts`:' to [x]",
            "dependencies": []
          },
          {
            "task_id": "T020",
            "agent_role": "Developer",
            "instruction": "T020 [US2] Write integration test for 2-tier escalation flow in `tests/integration/tier-engine.test.ts`:",
            "file_locks": [
              "tests/integration/tier-engine.test.ts"
            ],
            "constitution_rules": [],
            "completion_handshake": "Upon success, update tasks.md line containing 'T020 [US2] Write integration test for 2-tier escalation flow in `tests/integration/tier-engine.test.ts`:' to [x]",
            "dependencies": []
          },
          {
            "task_id": "T021",
            "agent_role": "Developer",
            "instruction": "T021 [US3] Create `openAuditDatabase(dbPath: string): Database` in `src/lifecycle/tier-db.ts` \u2014 creates directory if missing, opens SQLite file with `better-sqlite3`, runs DDL from `specs/003-tiered-escalation/contracts/sqlite-schema.md` (both `CREATE TABLE IF NOT EXISTS` statements and all three indexes); returns database handle",
            "file_locks": [
              "src/lifecycle/tier-db.ts",
              "specs/003-tiered-escalation/contracts/sqlite-schema.md"
            ],
            "constitution_rules": [],
            "completion_handshake": "Upon success, update tasks.md line containing 'T021 [US3] Create `openAuditDatabase(dbPath: string): Database` in `src/lifecycle/tier-db.ts` \u2014 creates directory if missing, opens SQLite file with `better-sqlite3`, runs DDL from `specs/003-tiered-escalation/contracts/sqlite-schema.md` (both `CREATE TABLE IF NOT EXISTS` statements and all three indexes); returns database handle' to [x]",
            "dependencies": []
          },
          {
            "task_id": "T028",
            "agent_role": "Developer",
            "instruction": "T028 [P] [US3] Write unit tests for `tier-db.ts` in `tests/unit/lifecycle/tier-db.test.ts` (use in-memory `:memory:` path for speed):",
            "file_locks": [
              "tests/unit/lifecycle/tier-db.test.ts",
              "tier-db.ts"
            ],
            "constitution_rules": [],
            "completion_handshake": "Upon success, update tasks.md line containing 'T028 [P] [US3] Write unit tests for `tier-db.ts` in `tests/unit/lifecycle/tier-db.test.ts` (use in-memory `:memory:` path for speed):' to [x]",
            "dependencies": []
          },
          {
            "task_id": "T031",
            "agent_role": "Developer",
            "instruction": "T031 Run full vitest test suite and confirm \u2265 290 tests pass (247 existing + ~43 new); confirm zero regressions \u2014 `npx vitest run`",
            "file_locks": [],
            "constitution_rules": [],
            "completion_handshake": "Upon success, update tasks.md line containing 'T031 Run full vitest test suite and confirm \u2265 290 tests pass (247 existing + ~43 new); confirm zero regressions \u2014 `npx vitest run`' to [x]",
            "dependencies": []
          }
        ],
        "checkpoint_after": {
          "enabled": true,
          "verification_criteria": "Verify all Wave 1 tasks are marked [x] in tasks.md",
          "git_agent": "git-version-manager",
          "memory_bank_agent": "memory-bank-keeper"
        }
      },
      {
        "wave_id": 2,
        "strategy": "PARALLEL_SWARM",
        "rationale": "Wave 2: 4 independent task(s) with no file conflicts",
        "tasks": [
          {
            "task_id": "T004",
            "agent_role": "Developer",
            "instruction": "T004 Implement `loadTierConfig(filePath: string): TierEscalationConfig` and `validateTierConfig(config): string[]` in `src/lifecycle/tier-config.ts` \u2014 reads JSON file, runs Zod parse, returns typed config or array of error strings; `validateTierConfig` returns ALL errors (not just first) so startup can report them all at once (FR-012)",
            "file_locks": [
              "src/lifecycle/tier-config.ts"
            ],
            "constitution_rules": [],
            "completion_handshake": "Upon success, update tasks.md line containing 'T004 Implement `loadTierConfig(filePath: string): TierEscalationConfig` and `validateTierConfig(config): string[]` in `src/lifecycle/tier-config.ts` \u2014 reads JSON file, runs Zod parse, returns typed config or array of error strings; `validateTierConfig` returns ALL errors (not just first) so startup can report them all at once (FR-012)' to [x]",
            "dependencies": [
              "T003"
            ]
          },
          {
            "task_id": "T008",
            "agent_role": "Developer",
            "instruction": "T008 [US1] Wire tier engine into `runCommand()` in `src/cli/commands/run.ts` \u2014 detect `options.tierConfig ?? config.tierConfigFile`; if present: call `loadTierConfig()`, call `validateTierConfig()` and exit with all errors if invalid (before any LLM call), then enter tier loop; if absent: fall through to existing simple/full path unchanged",
            "file_locks": [
              "src/cli/commands/run.ts",
              "options.tierConfig ?? config.tierConfigFile"
            ],
            "constitution_rules": [],
            "completion_handshake": "Upon success, update tasks.md line containing 'T008 [US1] Wire tier engine into `runCommand()` in `src/cli/commands/run.ts` \u2014 detect `options.tierConfig ?? config.tierConfigFile`; if present: call `loadTierConfig()`, call `validateTierConfig()` and exit with all errors if invalid (before any LLM call), then enter tier loop; if absent: fall through to existing simple/full path unchanged' to [x]",
            "dependencies": [
              "T007"
            ]
          },
          {
            "task_id": "T014",
            "agent_role": "Developer",
            "instruction": "T014 [P] [US2] Create `withTierEscalationContext(context: AgentContext, summary: AccumulatedFailureSummary): AgentContext` in `src/lifecycle/tier-accumulator.ts` \u2014 calls existing `withEscalationContext(context, summary.naturalLanguageSummary)` from `src/agents/base/agent-context.ts`; returns new context without mutating original",
            "file_locks": [
              "src/lifecycle/tier-accumulator.ts",
              "src/agents/base/agent-context.ts"
            ],
            "constitution_rules": [],
            "completion_handshake": "Upon success, update tasks.md line containing 'T014 [P] [US2] Create `withTierEscalationContext(context: AgentContext, summary: AccumulatedFailureSummary): AgentContext` in `src/lifecycle/tier-accumulator.ts` \u2014 calls existing `withEscalationContext(context, summary.naturalLanguageSummary)` from `src/agents/base/agent-context.ts`; returns new context without mutating original' to [x]",
            "dependencies": [
              "T013"
            ]
          },
          {
            "task_id": "T022",
            "agent_role": "Developer",
            "instruction": "T022 [US3] Create `writeAttemptRecord(db: Database, record: TierAttemptRecord): void` in `src/lifecycle/tier-db.ts` \u2014 prepared `INSERT INTO tier_attempts (...)` statement with all columns; `failedTests` and `errorMessages` serialized as `JSON.stringify()`; entire call wrapped in `try/catch`; on error: `logger.warn('[audit] DB write failed: ...')` and return (never throw)",
            "file_locks": [
              "logger.warn",
              "src/lifecycle/tier-db.ts"
            ],
            "constitution_rules": [],
            "completion_handshake": "Upon success, update tasks.md line containing 'T022 [US3] Create `writeAttemptRecord(db: Database, record: TierAttemptRecord): void` in `src/lifecycle/tier-db.ts` \u2014 prepared `INSERT INTO tier_attempts (...)` statement with all columns; `failedTests` and `errorMessages` serialized as `JSON.stringify()`; entire call wrapped in `try/catch`; on error: `logger.warn('[audit] DB write failed: ...')` and return (never throw)' to [x]",
            "dependencies": [
              "T021"
            ]
          }
        ],
        "checkpoint_after": {
          "enabled": true,
          "verification_criteria": "Verify all Wave 2 tasks are marked [x] in tasks.md",
          "git_agent": "git-version-manager",
          "memory_bank_agent": "memory-bank-keeper"
        }
      },
      {
        "wave_id": 3,
        "strategy": "PARALLEL_SWARM",
        "rationale": "Wave 3: 2 independent task(s) with no file conflicts",
        "tasks": [
          {
            "task_id": "T009",
            "agent_role": "Developer",
            "instruction": "T009 [US1] Add startup banner in `src/cli/commands/run.ts` when tier config is active \u2014 print tier plan table matching `contracts/cli-interface.md` \"Startup\" format: tier index, name, mode, model, max iterations",
            "file_locks": [
              "src/cli/commands/run.ts",
              "contracts/cli-interface.md"
            ],
            "constitution_rules": [],
            "completion_handshake": "Upon success, update tasks.md line containing 'T009 [US1] Add startup banner in `src/cli/commands/run.ts` when tier config is active \u2014 print tier plan table matching `contracts/cli-interface.md` \"Startup\" format: tier index, name, mode, model, max iterations' to [x]",
            "dependencies": [
              "T008",
              "T007"
            ]
          },
          {
            "task_id": "T023",
            "agent_role": "Developer",
            "instruction": "T023 [P] [US3] Create `writeRunMetadata(db: Database, metadata: RunMetadataRow): void` and `updateRunMetadata(db: Database, runId: string, updates: Partial<RunMetadataRow>): void` in `src/lifecycle/tier-db.ts` \u2014 `writeRunMetadata` does `INSERT INTO run_metadata`; `updateRunMetadata` does `UPDATE run_metadata SET ... WHERE run_id = ?`; both wrapped in `try/catch` with `logger.warn` on failure",
            "file_locks": [
              "logger.warn",
              "src/lifecycle/tier-db.ts"
            ],
            "constitution_rules": [],
            "completion_handshake": "Upon success, update tasks.md line containing 'T023 [P] [US3] Create `writeRunMetadata(db: Database, metadata: RunMetadataRow): void` and `updateRunMetadata(db: Database, runId: string, updates: Partial<RunMetadataRow>): void` in `src/lifecycle/tier-db.ts` \u2014 `writeRunMetadata` does `INSERT INTO run_metadata`; `updateRunMetadata` does `UPDATE run_metadata SET ... WHERE run_id = ?`; both wrapped in `try/catch` with `logger.warn` on failure' to [x]",
            "dependencies": [
              "T021",
              "T022"
            ]
          }
        ],
        "checkpoint_after": {
          "enabled": true,
          "verification_criteria": "Verify all Wave 3 tasks are marked [x] in tasks.md",
          "git_agent": "git-version-manager",
          "memory_bank_agent": "memory-bank-keeper"
        }
      },
      {
        "wave_id": 4,
        "strategy": "PARALLEL_SWARM",
        "rationale": "Wave 4: 2 independent task(s) with no file conflicts",
        "tasks": [
          {
            "task_id": "T010",
            "agent_role": "Developer",
            "instruction": "T010 [US1] Add per-tier header output at start of each tier in `src/lifecycle/tier-engine.ts` \u2014 print `\u2501\u2501\u2501\u2501 \u25b6 Tier N/total: <name> [mode, model] \u2501\u2501\u2501\u2501` divider matching `contracts/cli-interface.md` format",
            "file_locks": [
              "contracts/cli-interface.md",
              "src/lifecycle/tier-engine.ts"
            ],
            "constitution_rules": [],
            "completion_handshake": "Upon success, update tasks.md line containing 'T010 [US1] Add per-tier header output at start of each tier in `src/lifecycle/tier-engine.ts` \u2014 print `\u2501\u2501\u2501\u2501 \u25b6 Tier N/total: <name> [mode, model] \u2501\u2501\u2501\u2501` divider matching `contracts/cli-interface.md` format' to [x]",
            "dependencies": [
              "T009",
              "T007"
            ]
          },
          {
            "task_id": "T024",
            "agent_role": "Developer",
            "instruction": "T024 [P] [US3] Create `closeAuditDatabase(db: Database): void` in `src/lifecycle/tier-db.ts` \u2014 calls `db.close()` in `try/catch`; logs warning on failure but never throws",
            "file_locks": [
              "src/lifecycle/tier-db.ts"
            ],
            "constitution_rules": [],
            "completion_handshake": "Upon success, update tasks.md line containing 'T024 [P] [US3] Create `closeAuditDatabase(db: Database): void` in `src/lifecycle/tier-db.ts` \u2014 calls `db.close()` in `try/catch`; logs warning on failure but never throws' to [x]",
            "dependencies": [
              "T023",
              "T021",
              "T022"
            ]
          }
        ],
        "checkpoint_after": {
          "enabled": true,
          "verification_criteria": "Verify all Wave 4 tasks are marked [x] in tasks.md",
          "git_agent": "git-version-manager",
          "memory_bank_agent": "memory-bank-keeper"
        }
      },
      {
        "wave_id": 5,
        "strategy": "PARALLEL_SWARM",
        "rationale": "Wave 5: 2 independent task(s) with no file conflicts",
        "tasks": [
          {
            "task_id": "T011",
            "agent_role": "Developer",
            "instruction": "T011 [US1] Add final report for single-tier outcome in `src/cli/commands/run.ts` \u2014 per-tier row table (name, mode, iterations, cost, status), total line, audit path + run ID, SQLite query hint on failure \u2014 matching all three report formats in `contracts/cli-interface.md`",
            "file_locks": [
              "src/cli/commands/run.ts",
              "contracts/cli-interface.md"
            ],
            "constitution_rules": [],
            "completion_handshake": "Upon success, update tasks.md line containing 'T011 [US1] Add final report for single-tier outcome in `src/cli/commands/run.ts` \u2014 per-tier row table (name, mode, iterations, cost, status), total line, audit path + run ID, SQLite query hint on failure \u2014 matching all three report formats in `contracts/cli-interface.md`' to [x]",
            "dependencies": [
              "T008",
              "T009",
              "T007",
              "T010"
            ]
          },
          {
            "task_id": "T015",
            "agent_role": "Developer",
            "instruction": "T015 [US2] Extend `runTier()` in `src/lifecycle/tier-engine.ts` to support `full` mode tiers \u2014 when `tier.mode === 'full'`: calls `runSingleIteration()` (Librarian + Artisan + Critic + Tests) instead of `runSimpleIteration()`; Librarian receives `context.escalationContext` which was injected before this tier started",
            "file_locks": [
              "context.escalationContext",
              "tier.mode",
              "src/lifecycle/tier-engine.ts"
            ],
            "constitution_rules": [],
            "completion_handshake": "Upon success, update tasks.md line containing 'T015 [US2] Extend `runTier()` in `src/lifecycle/tier-engine.ts` to support `full` mode tiers \u2014 when `tier.mode === 'full'`: calls `runSingleIteration()` (Librarian + Artisan + Critic + Tests) instead of `runSimpleIteration()`; Librarian receives `context.escalationContext` which was injected before this tier started' to [x]",
            "dependencies": [
              "T007",
              "T010"
            ]
          }
        ],
        "checkpoint_after": {
          "enabled": true,
          "verification_criteria": "Verify all Wave 5 tasks are marked [x] in tasks.md",
          "git_agent": "git-version-manager",
          "memory_bank_agent": "memory-bank-keeper"
        }
      },
      {
        "wave_id": 6,
        "strategy": "PARALLEL_SWARM",
        "rationale": "Wave 6: 2 independent task(s) with no file conflicts",
        "tasks": [
          {
            "task_id": "T016",
            "agent_role": "Developer",
            "instruction": "T016 [US2] Add multi-tier escalation loop in `runCommand()` in `src/cli/commands/run.ts` \u2014 after each tier's `TierRunResult`:",
            "file_locks": [
              "src/cli/commands/run.ts"
            ],
            "constitution_rules": [],
            "completion_handshake": "Upon success, update tasks.md line containing 'T016 [US2] Add multi-tier escalation loop in `runCommand()` in `src/cli/commands/run.ts` \u2014 after each tier's `TierRunResult`:' to [x]",
            "dependencies": [
              "T008",
              "T009",
              "T011",
              "T007"
            ]
          },
          {
            "task_id": "T025",
            "agent_role": "Developer",
            "instruction": "T025 [US3] Wire DB writes into `runTier()` in `src/lifecycle/tier-engine.ts` \u2014 after each iteration completes, call `writeAttemptRecord(db, record)` with all fields populated: `runId`, `tierIndex`, `tierName`, `tierMode`, `modelArtisan`, `modelLibrarian` (null for simple mode), `modelCritic` (null for simple mode), `iteration`, `codeChangeSummary`, `testStatus`, `failedTests`, `errorMessages`, `costUsd`, `durationMs`, `timestamp` (ISO 8601 UTC)",
            "file_locks": [
              "src/lifecycle/tier-engine.ts"
            ],
            "constitution_rules": [],
            "completion_handshake": "Upon success, update tasks.md line containing 'T025 [US3] Wire DB writes into `runTier()` in `src/lifecycle/tier-engine.ts` \u2014 after each iteration completes, call `writeAttemptRecord(db, record)` with all fields populated: `runId`, `tierIndex`, `tierName`, `tierMode`, `modelArtisan`, `modelLibrarian` (null for simple mode), `modelCritic` (null for simple mode), `iteration`, `codeChangeSummary`, `testStatus`, `failedTests`, `errorMessages`, `costUsd`, `durationMs`, `timestamp` (ISO 8601 UTC)' to [x]",
            "dependencies": [
              "T015",
              "T007",
              "T010"
            ]
          }
        ],
        "checkpoint_after": {
          "enabled": true,
          "verification_criteria": "Verify all Wave 6 tasks are marked [x] in tasks.md",
          "git_agent": "git-version-manager",
          "memory_bank_agent": "memory-bank-keeper"
        }
      },
      {
        "wave_id": 7,
        "strategy": "SEQUENTIAL_MERGE",
        "rationale": "Wave 7: 1 independent task(s) with no file conflicts",
        "tasks": [
          {
            "task_id": "T017",
            "agent_role": "Developer",
            "instruction": "T017 [US2] Add escalation event log in `src/cli/commands/run.ts` between tiers \u2014 print: tier failure summary, escalation target tier name, count of prior iterations carried forward \u2014 matching `contracts/cli-interface.md` \"Tier Escalation Event\" format",
            "file_locks": [
              "src/cli/commands/run.ts",
              "contracts/cli-interface.md"
            ],
            "constitution_rules": [],
            "completion_handshake": "Upon success, update tasks.md line containing 'T017 [US2] Add escalation event log in `src/cli/commands/run.ts` between tiers \u2014 print: tier failure summary, escalation target tier name, count of prior iterations carried forward \u2014 matching `contracts/cli-interface.md` \"Tier Escalation Event\" format' to [x]",
            "dependencies": [
              "T009",
              "T011",
              "T010",
              "T007",
              "T016",
              "T008"
            ]
          }
        ],
        "checkpoint_after": {
          "enabled": true,
          "verification_criteria": "Verify all Wave 7 tasks are marked [x] in tasks.md",
          "git_agent": "git-version-manager",
          "memory_bank_agent": "memory-bank-keeper"
        }
      },
      {
        "wave_id": 8,
        "strategy": "SEQUENTIAL_MERGE",
        "rationale": "Wave 8: 1 independent task(s) with no file conflicts",
        "tasks": [
          {
            "task_id": "T018",
            "agent_role": "Developer",
            "instruction": "T018 [P] [US2] Update final report in `src/cli/commands/run.ts` for multi-tier outcomes \u2014 all three report scenarios (success mid-tier, all-failed, budget-stopped) from `contracts/cli-interface.md`; \"\u2014 (not reached)\" for skipped tiers",
            "file_locks": [
              "src/cli/commands/run.ts",
              "contracts/cli-interface.md"
            ],
            "constitution_rules": [],
            "completion_handshake": "Upon success, update tasks.md line containing 'T018 [P] [US2] Update final report in `src/cli/commands/run.ts` for multi-tier outcomes \u2014 all three report scenarios (success mid-tier, all-failed, budget-stopped) from `contracts/cli-interface.md`; \"\u2014 (not reached)\" for skipped tiers' to [x]",
            "dependencies": [
              "T009",
              "T017",
              "T011",
              "T010",
              "T007",
              "T016",
              "T008"
            ]
          }
        ],
        "checkpoint_after": {
          "enabled": true,
          "verification_criteria": "Verify all Wave 8 tasks are marked [x] in tasks.md",
          "git_agent": "git-version-manager",
          "memory_bank_agent": "memory-bank-keeper"
        }
      },
      {
        "wave_id": 9,
        "strategy": "SEQUENTIAL_MERGE",
        "rationale": "Wave 9: 1 independent task(s) with no file conflicts",
        "tasks": [
          {
            "task_id": "T026",
            "agent_role": "Developer",
            "instruction": "T026 [US3] Wire run metadata into `runCommand()` in `src/cli/commands/run.ts` \u2014 generate `runId = uuidv4()` at run start; call `openAuditDatabase(resolvedDbPath)` where `resolvedDbPath` is `global.auditDbPath` resolved relative to `options.workingDirectory`; call `writeRunMetadata()` with `outcome='in_progress'`; after all tiers complete, call `updateRunMetadata()` with final `outcome`, `completedAt`, `resolvedTierName`, `resolvedIteration`; call `closeAuditDatabase()` in a `finally` block",
            "file_locks": [
              "src/cli/commands/run.ts",
              "options.workingDirectory",
              "global.auditDbPath"
            ],
            "constitution_rules": [],
            "completion_handshake": "Upon success, update tasks.md line containing 'T026 [US3] Wire run metadata into `runCommand()` in `src/cli/commands/run.ts` \u2014 generate `runId = uuidv4()` at run start; call `openAuditDatabase(resolvedDbPath)` where `resolvedDbPath` is `global.auditDbPath` resolved relative to `options.workingDirectory`; call `writeRunMetadata()` with `outcome='in_progress'`; after all tiers complete, call `updateRunMetadata()` with final `outcome`, `completedAt`, `resolvedTierName`, `resolvedIteration`; call `closeAuditDatabase()` in a `finally` block' to [x]",
            "dependencies": [
              "T009",
              "T018",
              "T017",
              "T011",
              "T007",
              "T016",
              "T008"
            ]
          }
        ],
        "checkpoint_after": {
          "enabled": true,
          "verification_criteria": "Verify all Wave 9 tasks are marked [x] in tasks.md",
          "git_agent": "git-version-manager",
          "memory_bank_agent": "memory-bank-keeper"
        }
      },
      {
        "wave_id": 10,
        "strategy": "SEQUENTIAL_MERGE",
        "rationale": "Wave 10: 1 independent task(s) with no file conflicts",
        "tasks": [
          {
            "task_id": "T027",
            "agent_role": "Developer",
            "instruction": "T027 [US3] Show audit log path and run ID in final report in `src/cli/commands/run.ts` \u2014 `Audit: <path>  (run: <runId[:8]>)`; when all tiers fail, also print the SQLite query hint: `sqlite3 <path> \"SELECT * FROM tier_attempts WHERE run_id='<runId>' ORDER BY tier_index, iteration;\"`",
            "file_locks": [
              "src/cli/commands/run.ts"
            ],
            "constitution_rules": [],
            "completion_handshake": "Upon success, update tasks.md line containing 'T027 [US3] Show audit log path and run ID in final report in `src/cli/commands/run.ts` \u2014 `Audit: <path>  (run: <runId[:8]>)`; when all tiers fail, also print the SQLite query hint: `sqlite3 <path> \"SELECT * FROM tier_attempts WHERE run_id='<runId>' ORDER BY tier_index, iteration;\"`' to [x]",
            "dependencies": [
              "T009",
              "T018",
              "T017",
              "T011",
              "T026",
              "T007",
              "T016",
              "T008"
            ]
          }
        ],
        "checkpoint_after": {
          "enabled": true,
          "verification_criteria": "Verify all Wave 10 tasks are marked [x] in tasks.md",
          "git_agent": "git-version-manager",
          "memory_bank_agent": "memory-bank-keeper"
        }
      },
      {
        "wave_id": 11,
        "strategy": "SEQUENTIAL_MERGE",
        "rationale": "Wave 11: 1 independent task(s) with no file conflicts",
        "tasks": [
          {
            "task_id": "T029",
            "agent_role": "Developer",
            "instruction": "T029 [P] Add warning in `src/cli/commands/run.ts` when legacy flags (`--simple`, `--full`, `--no-escalate`) are used alongside `--tier-config` \u2014 log `logger.warn('\u26a0 --tier-config is active; --simple/--full/--no-escalate flags are ignored')` before entering tier engine path",
            "file_locks": [
              "src/cli/commands/run.ts",
              "logger.warn"
            ],
            "constitution_rules": [],
            "completion_handshake": "Upon success, update tasks.md line containing 'T029 [P] Add warning in `src/cli/commands/run.ts` when legacy flags (`--simple`, `--full`, `--no-escalate`) are used alongside `--tier-config` \u2014 log `logger.warn('\u26a0 --tier-config is active; --simple/--full/--no-escalate flags are ignored')` before entering tier engine path' to [x]",
            "dependencies": [
              "T009",
              "T018",
              "T017",
              "T011",
              "T026",
              "T027",
              "T022",
              "T023",
              "T007",
              "T016",
              "T008"
            ]
          }
        ],
        "checkpoint_after": {
          "enabled": true,
          "verification_criteria": "Verify all Wave 11 tasks are marked [x] in tasks.md",
          "git_agent": "git-version-manager",
          "memory_bank_agent": "memory-bank-keeper"
        }
      },
      {
        "wave_id": 12,
        "strategy": "SEQUENTIAL_MERGE",
        "rationale": "Wave 12: 1 independent task(s) with no file conflicts",
        "tasks": [
          {
            "task_id": "T030",
            "agent_role": "Developer",
            "instruction": "T030 [P] Add validation error reporter in `runCommand()` in `src/cli/commands/run.ts` \u2014 when `validateTierConfig()` returns errors, print each error with index (`Error 1: ...`, `Error 2: ...`) and a trailing `Fix the errors above and re-run. No LLM calls were made.` line; then `process.exit(1)` \u2014 matching `contracts/cli-interface.md` \"Validation Error Output\" format",
            "file_locks": [
              "process.exit",
              "src/cli/commands/run.ts",
              "contracts/cli-interface.md"
            ],
            "constitution_rules": [],
            "completion_handshake": "Upon success, update tasks.md line containing 'T030 [P] Add validation error reporter in `runCommand()` in `src/cli/commands/run.ts` \u2014 when `validateTierConfig()` returns errors, print each error with index (`Error 1: ...`, `Error 2: ...`) and a trailing `Fix the errors above and re-run. No LLM calls were made.` line; then `process.exit(1)` \u2014 matching `contracts/cli-interface.md` \"Validation Error Output\" format' to [x]",
            "dependencies": [
              "T009",
              "T029",
              "T018",
              "T017",
              "T011",
              "T026",
              "T027",
              "T010",
              "T007",
              "T016",
              "T008"
            ]
          }
        ],
        "checkpoint_after": {
          "enabled": true,
          "verification_criteria": "Verify all Wave 12 tasks are marked [x] in tasks.md",
          "git_agent": "git-version-manager",
          "memory_bank_agent": "memory-bank-keeper"
        }
      }
    ]
  }
}